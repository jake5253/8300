var checks={};function simpleInputValidation(){var a=checks.firstName.isValid(true);if(a){a=checks.lastName.isValid(true)}if(a){a=checks.username.isValid(true)}if(a){a=checks.usernameConfirm.isValid(true)}if(a){a=checks.password.isValid();if(!a){checks.password.isValid(true);$("#password").blur();$("#password").focus()}}if(a){a=checks.passwordConfirm.isValid(true);if(!a){$("passwordConfirm").blur();$("passwordConfirm").focus()}}if(a){a=checks.acceptTerms.isValid(true)}return a}function getCreateAccountCb(b,a){showView("landing");document.getElementById("firstName").focus();if(b){switch(b){case RAINIER.simple.account.errorCode.INVALID_USERNAME:showInputValidationError("usernameInputValidation",true,RAINIER.setup.ui.invalidEmail);break;case RAINIER.simple.account.errorCode.ACCOUNT_ALREADY_EXISTS:showGeneralError(RAINIER.createAccount.strings.accountExistsMessage.replace("{username}",a));break;default:showGeneralError(RAINIER.login.strings.unexpectedCloudError);break}}}function createAccountFailed(b,a){getCreateAccountCb(b,a)}function createAccount(){if(!simpleInputValidation()){return}showView("working");var b=RAINIER.shared.ui.getHtmlLang();var a={account:{username:document.getElementById("username").value,firstName:document.getElementById("firstName").value,lastName:document.getElementById("lastName").value,password:document.getElementById("password").value,gender:document.getElementById("gender").value,preferences:{locale:b,newsletterOptIn:document.getElementById("acceptPromotions").checked}}};RAINIER.cloud.send({url:"/cloud/user-service/rest/v2/accounts/u",type:"POST",data:a,cb:function(){showView("success")},cbError:function(c){RAINIER.simple.account.getErrorCode(c,function(d){createAccountFailed(d,a.account.username)})}})}function addValidation(){var a=RAINIER.ui.buildInputValidBalloon;checks={firstName:a($.extend(true,{},{els:$("#firstName"),minLen:1,maxLen:128,whiteSpace:false,isRequired:true})),lastName:a($.extend(true,{},{els:$("#lastName"),minLen:1,maxLen:128,whiteSpace:false,isRequired:true})),username:a($.extend(true,{},{els:$("#username"),minLen:7,maxLen:254,whiteSpace:false,isRequired:true,validationType:"email"})),usernameConfirm:a($.extend(true,{},{els:$("#usernameConfirm"),minLen:7,maxLen:254,whiteSpace:false,isRequired:true,validationType:"confirmEmail",elCompareTo:$("#username")})),password:a($.extend(true,{},{els:$("#password"),validationType:"newCloudPassword",isChecklist:true,noWarnIcon:true},RAINIER.network.getCloudAccountNewPasswordOptions())),passwordConfirm:a($.extend(true,{},{els:$("#passwordConfirm"),validationType:"confirmPassword",elCompareTo:$("#password")})),acceptTerms:a($.extend(true,{},{els:$("#accept-terms"),validationType:"checked",message:RAINIER.createAccount.strings.mustAcceptTerms}))}}function init(){RAINIER.jnap.send({action:"/jnap/core/GetDeviceInfo",data:{},cb:function(a){if(a.result==="OK"){RAINIER.setup.setRouterInfo(a.output)}else{if(a.result!=="_ErrorUnauthorized"){RAINIER.executeDefaultJnapErrorHandler(a)}}addValidation();showView("landing")},disableDefaultJnapErrHandler:true,disableDefaultAjaxErrHandler:true})}window.onload=function(){showView("loading");init()};RAINIER.page=RAINIER.page||{};RAINIER.page.createAccountSimple=RAINIER.page.createAccountSimple||{};RAINIER.page.createAccountSimple.init=init;RAINIER.page.createAccountSimple.createAccount=createAccount;